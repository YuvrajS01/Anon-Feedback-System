{% extends "base.html" %}

{% block title %}Submit Feedback - Student Feedback{% endblock %}

{% block content %}
<div class="card feedback-card">
    <h2>Submit Your Feedback</h2>
    <p class="subtitle">Rate each aspect on a scale of 1 (Poor) to 10 (Excellent)</p>

    <form action="{{ url_for('submit') }}" method="POST" class="feedback-form" id="feedbackForm">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <!-- Teacher & Subject Selection -->
        <div class="form-row">
            <div class="form-group">
                <label for="teacher">Select Teacher</label>
                <select id="teacher" name="teacher" required>
                    <option value="">-- Choose Teacher --</option>
                    {% for teacher in teachers %}
                    <option value="{{ teacher }}">{{ teacher }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="subject">Select Subject</label>
                <select id="subject" name="subject" required>
                    <option value="">-- Choose Subject --</option>
                    {% for subject in subjects %}
                    <option value="{{ subject }}">{{ subject }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <!-- Rating Questions -->
        <div class="questions-section">
            <h3>Rate the Following</h3>

            {% for question in questions %}
            <div class="question-item">
                <label class="question-label">
                    <span class="question-number">{{ loop.index }}.</span>
                    {{ question }}
                </label>
                <div class="rating-container">
                    <input type="range" name="q{{ loop.index }}" id="q{{ loop.index }}" min="1" max="10" value="5"
                        class="rating-slider">
                    <div class="rating-labels">
                        <span>1</span>
                        <span class="rating-value" id="value-q{{ loop.index }}">5</span>
                        <span>10</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Comments -->
        <div class="form-group">
            <label for="comment">Additional Comments (Optional)</label>
            <textarea id="comment" name="comment" placeholder="Share any additional feedback or suggestions..."
                rows="4"></textarea>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary btn-large">
            Submit Feedback âœ“
        </button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Update slider value display
    document.querySelectorAll('.rating-slider').forEach(slider => {
        const valueDisplay = document.getElementById('value-' + slider.id);

        slider.addEventListener('input', function () {
            valueDisplay.textContent = this.value;

            // Color coding based on value
            const value = parseInt(this.value);
            if (value <= 3) {
                valueDisplay.className = 'rating-value rating-low';
            } else if (value <= 6) {
                valueDisplay.className = 'rating-value rating-medium';
            } else {
                valueDisplay.className = 'rating-value rating-high';
            }
        });

        // Trigger initial update
        slider.dispatchEvent(new Event('input'));
    });

    // Form validation
    document.getElementById('feedbackForm').addEventListener('submit', function (e) {
        const teacher = document.getElementById('teacher').value;
        const subject = document.getElementById('subject').value;

        if (!teacher || !subject) {
            e.preventDefault();
            alert('Please select both a teacher and a subject.');
        }
    });
</script>
{% endblock %}